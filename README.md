# 🎹 剑网三自动演奏工具

> 南音三弦专用自动弹奏工具，快去卖艺吧！

![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)
![GUI](https://img.shields.io/badge/GUI-PyQt5-green.svg)
![Game](https://img.shields.io/badge/Game-剑网三-red.svg)
![Version](https://img.shields.io/badge/Version-2.0%20增强版-orange.svg)

## 🎵 这是什么？

还在羡慕别人弹琴动听，而你却只会瞎按吵闹吗？这个工具可以帮你把 MIDI 文件自动转换成游戏内的按键序列，让你能演奏出美妙的音乐！

简单来说，就是：**按键开启，帮你弹琴** 🎹

## ✨ 新功能特性

### ⚡ 倍速播放功能
- **1.0x (正常速度)** - 保持原始MIDI速度
- **1.25x (1.25倍速)** - 播放速度提升25%，时间减少20%
- **1.5x (1.5倍速)** - 播放速度提升50%，时间减少33.3%
- **1.75x (1.75倍速)** - 播放速度提升75%，时间减少42.9%
- **2.0x (2倍速)** - 播放速度提升100%，时间减少50%

### 🎼 八度变调功能  
- **-8度 (低八度)** - 将所有音符降低一个八度，音域更低沉
- **0度 (不变调)** - 保持原始音高
- **+8度 (高八度)** - 将所有音符升高一个八度，音域更明亮

### 🔥 实时调整功能
- **双重倍速机制** - 支持转换时和播放时的倍速叠加
- **实时速度调整** - 播放过程中可以动态改变速度
- **智能兼容** - 新旧JSON文件完全兼容

## 🚀 快速开始

1. **准备你的 MIDI 文件**
   - 下载或制作 `.mid`
   - 受限于剑网三演奏环境简陋，以及按键频率的问题，`.mid`尽可能不要太多音符与快速升降调
   - 工具只解析前两条音轨，复杂的音轨效果并不好

2. **启动工具**
   - 运行 `剑网三自动演奏工具.exe`
   - 或者如果你是开发者，直接运行 `python gui.py`

3. **配置播放设置** ⭐ 新功能
   - 在左侧 **"⚙️ 播放设置"** 中选择倍速和变调
   - **🚀 播放速度**: 选择1.0x - 2.0x的播放倍速
   - **🎼 八度变调**: 选择-8度/不变调/+8度

4. **导入音乐**
   - 在界面中导入你的 MIDI 文件
   - 工具会自动应用你选择的设置并生成按键序列
   - 生成的文件保存在 `midi` 文件夹下

5. **开始演奏**
   - 进入剑网三游戏，使用`南音三弦`挂件，选择高级弹奏
   - 选择工具中的音乐列表，可在播放时调整速度
   - 点击播放，开始表演！

## 🖥️ 界面操作指南

### 控制面板布局
```
🎛️ 主界面
├─ ⚙️ 播放设置
│  ├─ 🚀 播放速度: [1.0x/1.25x/1.5x/1.75x/2.0x]
│  └─ 🎼 八度变调: [-8度/不变调/+8度]
├─ 📁 导入MIDI - 批量导入MIDI文件
├─ 🎵 音乐列表 - 选择要播放的音乐
└─ ▶️ 播放控制 - 开始/停止演奏
```

### 操作流程
1. **设置优先** - 先选择播放速度和变调，再导入文件
2. **批量转换** - 可以一次导入多个MIDI文件
3. **实时调整** - 播放时可以改变速度，无需重新转换
4. **查看详情** - 文件信息显示转换参数和音符统计

## 🎯 使用建议

### 🚀 倍速选择指南
| 倍速 | 适用场景 | 播放时长 (2分钟原曲) | 推荐音乐类型 |
|------|---------|---------------------|------------|
| **1.0x** | 速度刚好 | 2分0秒 | 节奏适中的MIDI |
| **1.25x** | 轻微加速 | 1分36秒 | 稍慢的流行歌曲 |
| **1.5x** | 明显加速 | 1分20秒 | 慢歌、抒情音乐 |
| **1.75x** | 显著加速 | 1分8秒 | 很慢的MIDI文件 |
| **2.0x** | 大幅加速 | 1分0秒 | 极慢的古典音乐 |

### 🎼 变调选择指南
- **+8度 (高八度)**: 当音符太低，游戏无法演奏时使用
- **不变调**: 大部分情况下的默认选择
- **-8度 (低八度)**: 当音符太高，超出游戏音域时使用

### 🎵 推荐设置组合
- **流行歌曲**: 1.5倍速 + 不变调
- **古典音乐**: 1.25-1.5倍速 + 根据音域调整变调
- **慢歌/抒情**: 1.75倍速 + 不变调
- **偏慢MIDI**: 2.0倍速 + 不变调
- **精细调节**: 根据感觉在1.25-2.0x间选择

### 🎮 游戏中的最佳实践
1. **先测试**: 导入后查看覆盖率和音域信息
2. **调整参数**: 如果覆盖率低，尝试变调
3. **实际试听**: 在游戏中播放，根据感觉调整速度
4. **动态调整**: 播放时可以实时改变速度

## ⚡ 实时倍速功能详解

### 双重倍速机制
现在支持**两级倍速调整**：
1. **转换时倍速**: 生成JSON文件时应用的速度
2. **播放时倍速**: 播放时GUI选择的速度

**最终效果** = 转换时倍速 × 播放时倍速

### 效果演示
| 转换时倍速 | 播放时倍速 | 最终效果 | 2分钟音乐播放时间 |
|-----------|-----------|---------|-----------------|
| 1.0x | 1.0x | 1.0x | 2分0秒 |
| 1.0x | 1.5x | 1.5x | 1分20秒 ✅ |
| 1.0x | 2.0x | 2.0x | 1分0秒 ✅ |
| 1.5x | 1.5x | 2.25x | 53秒 ✅ |

### 兼容性保证
- ✅ **旧JSON文件**: 自动识别为1.0x转换倍速，完全兼容
- ✅ **新JSON文件**: 保存转换时倍速，支持播放时再次调整

## 📝 注意事项

- 确保游戏窗口处于活动状态, 使用的是DD驱动，前台按键
- 如果DD驱动加载失败，尝试重启工具即可
- （请在合适的游戏环境中使用，避免影响其他玩家）

## 🔧 技术细节

### 数据格式更新
生成的JSON文件增加了新字段：
- `speed_multiplier`: 存储播放速度倍数
- `octave_transpose`: 存储八度变调设置

### 兼容性说明
- **向后兼容**: 旧版本生成的文件仍可正常播放
- **向前兼容**: 新文件在播放器中会正确应用速度和变调设置

### 技术架构
- **DD驱动**: 使用`dd.54900.dll`进行硬件级输入模拟
- **MIDI解析**: 基于`mido`库进行MIDI文件解析
- **GUI框架**: 使用PyQt5构建用户界面
- **多线程**: 支持后台批量转换和非阻塞播放

## 📊 效果展示

### 转换时的文件信息显示：
```
📊 文件信息:
  🎵 曲目名称: 我的祖国
  🎼 音轨数量: 2
  ⏱️ 总时长: 125.30秒
  🎵 移调: 0半音
  ⚡ 播放速度: 1.5倍        ← 转换时设置
  🎼 八度变调: +1度         ← 转换时设置
  🎹 处理音轨: [0, 1]
  🔢 音符数量: 850
```

### 播放时的速度信息显示：
```
🎵 曲目: 我的祖国
⚡ 播放倍速: 2.0x          ← GUI当前选择
📄 文件倍速: 1.5x          ← 文件生成时设置
🎯 实际倍速: 3.0x          ← 最终效果
📊 统计: 1429个操作, 881个按键, 548个延迟
```

## 🤝 开发者说明

### 项目结构
```
jx3_piano/
├── gui.py              # 主GUI程序
├── build_music.py      # MIDI转换核心模块
├── player.py           # 播放器模块
├── pydd.py            # DD驱动接口
├── dd.54900.dll       # DD驱动文件
├── requirements.txt    # 依赖列表
└── build_exe.py       # 打包脚本
```

### 开发环境
```bash
# 安装依赖
pip install -r requirements.txt

# 运行程序
python gui.py

# 打包程序
python build_exe.py
```

### 贡献指南
如果你也是开发者，欢迎：
- 📝 查看源码并提出建议
- 🐛 报告Bug或问题
- ✨ 贡献新功能代码
- 📖 完善文档说明

---

**作者**: 66maer  
**版本**: 2.0 增强版  
**更新日期**: 2025-01-17  
**新功能**: 倍速播放、八度变调、实时调整
